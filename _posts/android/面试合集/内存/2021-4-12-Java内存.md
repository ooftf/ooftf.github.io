---
layout: post
author: "ooftf"
tags: Android
top: true
---

# 内存
## 内存模型（JMM）
## Java内存空间
![内存空间](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWcyMDE4LmNuYmxvZ3MuY29tL2Jsb2cvMTQ4OTY2OS8yMDE4MTAvMTQ4OTY2OS0yMDE4MTAwOTE4NTUyNzMxNi0xNzA4NzkwOTc0LnBuZw?x-oss-process=image/format,png)
### 相关文章
https://blog.csdn.net/laomo_bible/article/details/83067810
https://blog.csdn.net/singwhatiwanna/article/details/111713858?spm=1001.2014.3001.5501  
* 但类似于 “基本变量++” / “volatile++” 这种复合操作并没有原子性。比如 i++;


#### 线程私有
1. 程序计数器  
   记录当前线程所执行字节码的行号指示器
2. 虚拟机栈  
   存放了当前线程调用方法的局部变量表、操作数栈、动态链接、方法返回值等信息（可以理解为线程的栈）
3. 本地方法栈  
   为虚拟机使用的Native方法提供服务，后多与JVM Stack合并为一起

#### 线程共享
1. 堆  
   占据了虚拟机管理内存中最大的一块（没想到吧），唯一目的就是存放对象实例（与引用是两个概念），也是垃圾回收器主要管理的地方，故又称GC堆。
2. 方法区（JDK 1.7）（被称之为“永久代”）  
   存储加载的类信息、常量区、静态变量、JIT（即时编译器）处理后的数据等，类的信息包含类的版本、字段、方法、接口等信息。需要注意是常量池就在方法区中
3. 元空间（JDK 1.8）


* 字符串常量
  * JDK1.6 和 1.6 之前字符串常量池位于方法区。
  * JDK1.7 字符串常量池被移至堆。
  * JDK1.8 字符串常量池依然存放在堆中。



### 问题
* 1.7和1.8有什么不同
* 常量池指的什么
* 字符串常量存放在哪里


## GC
* 如何判定为垃圾
* 如何进行回收
* 垃圾回收是如何减少空间碎片和提高效率
* 什么时候会触发GC
* 什么时候对象从年轻代转移到老年代
    * 经历15此回收（15这个值可改变）
    * 大对象（字符串与数组），即超过了设定的值的对象，直接在老年代中分配
    * 首先根据 TargetSurvivorRatio 指定的比例，乘以 survivor 一个区的大小，得出目标晋升空间大小。然后将分代对象大小，按照分代年龄从小到大相加，直到大于目标晋升空间大小。之后，将得出的这个分代年龄以上的对象全部晋升。
* 为什么新生代内存需要有两个Survivor区
  为了使用复制清除算法，因为复制清除算法的过程是，先将需要清除垃圾的区域内存活对象，移向一侧然后将所有存活对象整个移动到一个空白区域，如果这个区域不是空白，就有可能导致无法整个转移？？？
* Minor GC 和Full GC


### GC时机 (?)
1. YGC（Minor GC）的时机:
   * edn空间不足
2. FGC（Full GC）的时机：
   * old空间不足；
   * perm空间不足；
   * 显示调用System.gc() ，包括RMI等的定时触发;
   * YGC时的悲观策略；
   * dump live的内存信息时(jmap –dump:live)。
### GC Root  两个版本
来自LeakCanary文档
* Local variables, which belong to the stack of a thread.
* Instances of active Java threads.
* System Classes, which never unload.
* Native references, which are controlled by native code.


出自sun公司java团队员工书籍
* Temporary variables on the stack (of any thread)
* Static variables (from any class)
* Special references from JNI native code。

### 资料
[Java对象循环引用，Java gc 如何回收](https://blog.csdn.net/leonardo9029/article/details/50241115)
[GC算法](https://www.cnblogs.com/feng9exe/p/7268524.html)



